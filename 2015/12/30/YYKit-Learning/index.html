<!DOCTYPE html>
<!--[if lte IE 8 ]>
<html class="ie" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<![endif]-->
<!--[if (gte IE 9)|!(IE)]><!-->
<!--
***************  *      *     *
      8          *    *       *
      8          *  *         *
      8          **           *
      8          *  *         *
      8          *    *       *
      8          *      *     *
      8          *        *   ***********    -----Theme By Kieran(http://go.kieran.top)
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<!--<![endif]-->

<head>
  <title>YYKit Learning(一) | MADAO</title>
  <!-- Meta data -->
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" >
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="generator" content="MADAO">
    <meta name="author" content="MADAO">
    <meta name="description" content="" />
    <meta name="keywords" content="" />

    <!-- Favicon, (keep icon in root folder) -->
    <link rel="Shortcut Icon" href="/img/favicon.ico" type="image/ico">

    <link rel="alternate" href="/atom.xml" title="MADAO" type="application/atom+xml">
    <link rel="stylesheet" href="/css/all.css" media="screen" type="text/css">
	
    <link rel="stylesheet" href="/highlightjs/vs.css" type="text/css">
    
    

    <!-- Custom stylesheet, (add custom styles here, always load last) -->
    <!-- Load our stylesheet for IE8 -->
    <!--[if IE 8]>
    <link rel="stylesheet" type="text/css" href="/css/ie8.css" />
    <![endif]-->

    <!-- Google Webfonts (Monserrat 400/700, Open Sans 400/600) -->
    <link href='//fonts.useso.com/css?family=Montserrat:400,700' rel='stylesheet' type='text/css'>
    <link href='//fonts.useso.com/css?family=Open+Sans:400,600' rel='stylesheet' type='text/css'>

    <!-- Load our fonts individually if IE8+, to avoid faux bold & italic rendering -->
    <!--[if IE]>
    <link href='http://fonts.useso.com/css?family=Montserrat:400' rel='stylesheet' type='text/css'>
    <link href='http://fonts.useso.com/css?family=Montserrat:700' rel='stylesheet' type='text/css'>
    <link href='http://fonts.useso.com/css?family=Open+Sans:400' rel='stylesheet' type='text/css'>
    <link href='http://fonts.useso.com/css?family=Open+Sans:600' rel='stylesheet' type='text/css'>
    <![endif]-->

    <!-- jQuery | Load our jQuery, with an alternative source fallback to a local version if request is unavailable -->
    <script src="/js/jquery-1.11.1.min.js"></script>
    <script>window.jQuery || document.write('<script src="js/jquery-1.11.1.min.js"><\/script>')</script>

    <!-- Load these in the <head> for quicker IE8+ load times -->
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="/js/html5shiv.min.js"></script>
    <script src="/js/respond.min.js"></script>
    <![endif]-->










  
  
  

  
  <style>.col-md-8.col-md-offset-2.opening-statement img{display:none;}</style>
</head>

<!--
<body class="post-template">
-->
<body id="index" class="lightnav animsition">

      <!-- ============================ Off-canvas navigation =========================== -->

    <div class="sb-slidebar sb-right sb-style-overlay sb-momentum-scrolling">
        <div class="sb-close" aria-label="Close Menu" aria-hidden="true">
            <img src="/img/close.png" alt="Close"/>
        </div>
        <!-- Lists in Slidebars -->
        <ul class="sb-menu">
            <li><a href="/" class="animsition-link" title="Home">Home</a></li>
            <li><a href="/archives" class="animsition-link" title="archive">archives</a></li>
            <!-- Dropdown Menu -->
			 
            <li>
                <a class="sb-toggle-submenu">Works<span class="sb-caret"></span></a>
                <ul class="sb-submenu">
                    
                        <li><a href="/" target="_BLANK" class="animsition-link">AAA</a></li>
                    
                        <li><a href="/atom.xml" target="_BLANK" class="animsition-link">BBB</a></li>
                    
                </ul>
            </li>
            
            
            
            <li>
                <a class="sb-toggle-submenu">Links<span class="sb-caret"></span></a>
                <ul class="sb-submenu">
                    
                    <li><a href="http://go.kieran.top/" class="animsition-link">Kieran</a></li>
                    
                    <li><a href="http://domain.com/" class="animsition-link">Name</a></li>
                    
                </ul>
            </li>
            
        </ul>
        <!-- Lists in Slidebars -->
        <ul class="sb-menu secondary">
            <li><a href="/about.html" class="animsition-link" title="about">About</a></li>
            <li><a href="/atom.xml" class="animsition-link" title="rss">RSS</a></li>
        </ul>
    </div>
    
    <!-- ============================ END Off-canvas navigation =========================== -->

    <!-- ============================ #sb-site Main Page Wrapper =========================== -->

    <div id="sb-site">
        <!-- #sb-site - All page content should be contained within this id, except the off-canvas navigation itself -->

        <!-- ============================ Header & Logo bar =========================== -->

        <div id="navigation" class="navbar navbar-fixed-top">
            <div class="navbar-inner">
                <div class="container">
                    <!-- Nav logo -->
                    <div class="logo">
                        <a href="/" title="Logo" class="animsition-link">
                         <img src="/img/logo.png" alt="Logo" width="35px;"/> 
                        </a>
                    </div>
                    <!-- // Nav logo -->
                    <!-- Info-bar -->
                    <nav>
                        <ul class="nav">
                            <li><a href="/" class="animsition-link">MADAO</a></li>
                            <li class="nolink"><span>Always </span>Creative.</li>
                            
                            <li><a href="https://github.com/" title="Github" target="_blank"><i class="icon-github"></i></a></li>
                            
                            
                            <li><a href="https://twitter.com/" title="Twitter" target="_blank"><i class="icon-twitter"></i></a></li>
                            
                            
                            <li><a href="https://www.facebook.com/" title="Facebook" target="_blank"><i class="icon-facebook"></i></a></li>
                            
                            
                            <li><a href="https://google.com/" title="Google-Plus" target="_blank"><i class="icon-google-plus"></i></a></li>
                            
                            
                            <li><a href="http://weibo.com/" title="Sina-Weibo" target="_blank"><i class="icon-sina-weibo"></i></a></li>
                            
                            <li class="nolink"><span>Welcome!</span></li>
                        </ul>
                    </nav>
                    <!--// Info-bar -->
                </div>
                <!-- // .container -->
                <div class="learnmore sb-toggle-right">More</div>
                <button type="button" class="navbar-toggle menu-icon sb-toggle-right" title="More">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar before"></span>
                <span class="icon-bar main"></span>
                <span class="icon-bar after"></span>
                </button>
            </div>
            <!-- // .navbar-inner -->
        </div>

        <!-- ============================ Header & Logo bar =========================== -->

        <!-- ============================ Hero Image =========================== -->

        <section id="hero" class="scrollme">
            <div class="container-fluid element-img" style="background: url(/img/bg_img.jpg) no-repeat center center fixed;background-size: cover">
                <div class="row">
                    <div class="col-xs-12 col-sm-8 col-sm-offset-2 col-md-8 col-md-offset-2 vertical-align cover boost text-center">
                        <div class="center-me animateme" data-when="exit" data-from="0" data-to="0.6" data-opacity="0" data-translatey="100">
                            <div>
                            	
                                <h2>YOU'VE MADE A <span>BRAVE</span> DECISION, WELCOME.</h2>
                                <p></p>
				    			
                                <h2></h2>
                                <p>每一个不曾起舞的日子都是对生命的辜负。</p>
				    			

                            </div>
                        </div>
                    </div>
                    <!-- // .col-md-12 -->
                </div>
                <div class="herofade beige-dk"></div>
            </div>
        </section>

        <!-- Height spacing helper -->
        <div class="heightblock"></div>
        <!-- // End height spacing helper -->

        <!-- ============================ END Hero Image =========================== -->
      
<section id="intro">
    <div class="container">
        <div class="row col-md-offset-2">
            <div class="col-md-8">
    			<span class="post-meta">
      <time datetime="2015-12-30T02:49:07.000Z" itemprop="datePublished">
          2015-12-30
      </time>
    
</span>
                <h1>YYKit Learning(一)</h1>
            </div>
        </div>
        <div class="col-md-8 col-md-offset-2">
      		<h1 id="YYCategories"><a href="#YYCategories" class="headerlink" title="YYCategories"></a>YYCategories</h1><h2 id="NSObject_+_YYAdd"><a href="#NSObject_+_YYAdd" class="headerlink" title="NSObject + YYAdd"></a>NSObject + YYAdd</h2><h3 id="28id_29performSelectorWithArgs_3A_28SEL_29sel_2C__u2026_3B"><a href="#28id_29performSelectorWithArgs_3A_28SEL_29sel_2C__u2026_3B" class="headerlink" title="- (id)performSelectorWithArgs:(SEL)sel, …;"></a>- (id)performSelectorWithArgs:(SEL)sel, …;</h3><p>实现OC中的可变参数传递的方法  </p>
<pre><code>- (id)performSelectorWithArgs:(SEL)sel, ..
{
INIT_INV(sel, nil);
 [inv invoke];
 return [NSObject getReturnFromInv:inv withSig:sig];
}   
</code></pre><h4 id="INIT_INV_28sel_2Cnil_29"><a href="#INIT_INV_28sel_2Cnil_29" class="headerlink" title="INIT_INV(sel,nil)"></a>INIT_INV(sel,nil)</h4><p>一个宏函数，使用了C标准的stdarg.h库。<br>内容如下  </p>
<pre><code>#define INIT_INV(_last_arg_, _return_) \
NSMethodSignature * sig = [self methodSignatureForSelector:sel]; \
if (!sig) { [self doesNotRecognizeSelector:sel]; return _return_; } \
NSInvocation *inv = [NSInvocation invocationWithMethodSignature:sig]; \
if (!inv) { [self doesNotRecognizeSelector:sel]; return _return_; } \
[inv setTarget:self]; \
[inv setSelector:sel]; \
va_list args; \
va_start(args, _last_arg_); \
[NSObject setInv:inv withSig:sig andArgs:args]; \
va_end(args); 
</code></pre><h4 id="va_list__u7B49_u51FD_u6570"><a href="#va_list__u7B49_u51FD_u6570" class="headerlink" title="va_list 等函数"></a>va_list 等函数</h4><p>  一个C自带的可以用来遍历参数的函数，主要有以下几个：  </p>
<pre><code>va_list,  
va_arg(argp,type),  
va_start,  
va_end   
</code></pre><p> va<em> list主要用于创建一个遍历参数的指针，取参都是通过移动指针来取。原理如下：如下：<br> <strong>void func(int x, float y, char z);<br>　那么，调用函数的时候，实参 char z 先进栈，然后是 float y，最后是 int x，因此在内存中变量的存放次序是 x-&gt;y-&gt;z，因此，从理论上说，我们只要探测到任意一个变量的地址，并且知道其他变量的类型，通过指针移位运算，则总可以顺藤摸瓜找到其他的输入变量。</strong><br>va</em> arg(argp,type) :<br>　可获取当前va<em>list创建的指针的内容，argp为刚才创建的指针，type为参数类型,每次调用会使指针移动？<br>va</em> start(argp,par) :<br>　argp指向传入的第一个可选参数，msg是最后一个确定的参数<br>va_ end :<br> 结束标记。  </p>
<pre><code>#include &lt;stdio.h&gt;
#include &lt;stdarg.h&gt;

void demo(int num,...)
{
    va_list pt;
    va_start(pt, num);
    if(num) //取第一个参数
    {
        printf(&quot;%d\n&quot;,num);
    }
    while (1) {
        int number = va_arg(pt, int);
        if (number != -1 ) {
            printf(&quot;%d\n&quot;,number);
        }
        else{
            va_end(pt);
            break;
        }
    }
}

int main(int argc, const char * argv[]) {
    // insert code here...
    demo(4,5,6,7,8,-1);
    return 0;
}  
</code></pre><p>以上是自己写的一个传多参数的C函数。<a href="http://www.cnblogs.com/hanyonglu/archive/2011/05/07/2039916.html" target="_blank" rel="external">参考地址</a></p>
<h4 id="NSMethodSignature_u548CNSInvocation"><a href="#NSMethodSignature_u548CNSInvocation" class="headerlink" title="NSMethodSignature和NSInvocation"></a>NSMethodSignature和NSInvocation</h4><p>通常两者相结合使用。官方文档：<a href="https://developer.apple.com/library/ios/documentation/Cocoa/Reference/Foundation/Classes/NSMethodSignature_Class/index.html" target="_blank" rel="external">NSMethodSignature</a><br>大致意思表示NSMethodSignature对象能够记录方法的方法类型，参数，返回值信息。想让方法多次转发到多个分散对象中时，可以使用NSMehthodSignature，这种情况下，可以先使用methodSignatureForSelector:方法对方法做签名，然后再创建一个NSInvocation实例与方法签名进行关联。通过NSInvocation的实例对象来对方法的Target，Selector，Argument进行统一设置，最后通过invoke方法进行方法调用。<br>现在再回头看INIT_INV(sel,nil) 会容易理解很多：<br>首先传入方法，对方法进行签名和Invoke关联，关联失败进入系统的Error Handle 进行处理。成功则用var_list和Invoke实例进行参数设定。接下来便转入下一个的函数：  </p>
<pre><code>+ (void)setInv:(NSInvocation *)inv withSig:(NSMethodSignature *)sig andArgs:(va_list)args   
</code></pre><p>大致内容就是对参数类型进行分析，因为var_arg函数并不能自己判断类型，所以只能手动进行过滤和判断。对于不支持的参数类型（大型数组等），YY写了一套重试机制，主要是尝试获取更多的长度来确保参数完整性。  </p>
<h3 id="+__28BOOL_29swizzleInstanceMethod_3A_28SEL_29originalSel_with_3A_28SEL_29newSel"><a href="#+__28BOOL_29swizzleInstanceMethod_3A_28SEL_29originalSel_with_3A_28SEL_29newSel" class="headerlink" title="+ (BOOL)swizzleInstanceMethod:(SEL)originalSel with:(SEL)newSel"></a>+ (BOOL)swizzleInstanceMethod:(SEL)originalSel with:(SEL)newSel</h3><p>利用ObjRunTime分装的方法交换器对两中方法进行交换。  </p>
<pre><code>+ (BOOL)swizzleInstanceMethod:(SEL)originalSel with:(SEL)newSel {
    Method originalMethod = class_getInstanceMethod(self, originalSel);
    Method newMethod = class_getInstanceMethod(self, newSel);
    if (!originalMethod || !newMethod) return NO;

class_addMethod(self,
                originalSel,
                class_getMethodImplementation(self, originalSel),
                method_getTypeEncoding(originalMethod));
class_addMethod(self,
                newSel,
                class_getMethodImplementation(self, newSel),
                method_getTypeEncoding(newMethod));

method_exchangeImplementations(class_getInstanceMethod(self, originalSel),
                               class_getInstanceMethod(self, newSel));
return YES;
</code></pre><p>}</p>
<h4 id="class_getInstanceMethod"><a href="#class_getInstanceMethod" class="headerlink" title="class_getInstanceMethod"></a>class_getInstanceMethod</h4><p>获取一个Method对象，对象包括一个方法的返回值，SEL,参数等信息。  </p>
<h4 id="class_addMethod"><a href="#class_addMethod" class="headerlink" title="class_addMethod"></a>class_addMethod</h4><p>这里需要重点说一下的一个方法，它先是添加原Selector,作用是做一层保护，当Class不含这个方法或者对这个方法无法处理的时候，不会进行消息转发，跑到父类去找方法，这是我们不想要的结果。<br><a href="http://tech.glowing.com/cn/method-swizzling-aop/" target="_blank" rel="external">Method Swizzling和AOP实践</a><br><a href="http://www.cnblogs.com/xwang/p/3542515.html" target="_blank" rel="external">objc语言的运行时处理</a> </p>
<h3 id="28void_29setAssociateValue_3A_28id_29value_withKey_3A_28void_*_29key"><a href="#28void_29setAssociateValue_3A_28id_29value_withKey_3A_28void_*_29key" class="headerlink" title="- (void)setAssociateValue:(id)value withKey:(void *)key"></a>- (void)setAssociateValue:(id)value withKey:(void *)key</h3><p>objcRuntime的一种使用方法，可以将两个值进行关联，某些地方还是比较有用的。比如   </p>
<pre><code>- (void)buttonOnClicked:(UIButton *)sender;
</code></pre><p>该方法只能传一个值Sender，通过对对象进行关联，就可以附加属性。</p>
<h4 id="objc_setAssociatedObject"><a href="#objc_setAssociatedObject" class="headerlink" title="objc_setAssociatedObject"></a>objc_setAssociatedObject</h4><p>设置关联的runtime方法，四个参数：源对象，关键字，关联的对象和一个关联策略。关联的策略比较重要，有一下四个： </p>
<pre><code>
enum {
    OBJC_ASSOCIATION_ASSIGN = 0,      弱引用/**&lt; Specifies a weak reference to the associated object. */  
    OBJC_ASSOCIATION_RETAIN_NONATOMIC = 1, /**&lt; Specifies a strong reference to the associated object.
                                            *   The association is not made atomically. */
    OBJC_ASSOCIATION_COPY_NONATOMIC = 3,   /**&lt; Specifies that the associated object is copied.
                                            *   The association is not made atomically. */
    OBJC_ASSOCIATION_RETAIN = 01401,       /**&lt; Specifies a strong reference to the associated object.
                                            *   The association is made atomically. */
    OBJC_ASSOCIATION_COPY = 01403          /**&lt; Specifies that the associated object is copied.
                                            *   The association is made atomically. */
};
</code></pre><p>主要是对关联对象的原子性及引用策略做设置。    </p>
<h4 id="objc_getAssociatedObject"><a href="#objc_getAssociatedObject" class="headerlink" title="objc_getAssociatedObject"></a>objc_getAssociatedObject</h4><p>通过关键字获取关联的对象</p>
<h4 id="objc_removeAssociatedObjects"><a href="#objc_removeAssociatedObjects" class="headerlink" title="objc_removeAssociatedObjects"></a>objc_removeAssociatedObjects</h4><p>解除所有关联对象，若想解除指定对象，可以重写一遍setAssociate方法，关键字不变，关联对象写为nil即可。<br>此块不难。封装也只是单条语句。<br>多重关联也是可以的：  </p>
<pre><code>/**与Button进行关联*/
objc_setAssociatedObject(sender, ASS_BUTTON_KEY, self.lblTextOne.text, OBJC_ASSOCIATION_ASSIGN);
/**与Navi进行关联*/
objc_setAssociatedObject(self.navigationController, ASS_NAVI_KEY, sender, OBJC_ASSOCIATION_ASSIGN);
objc_setAssociatedObject(self.navigationController, ASS_MT_KEY, self.lblTextTwo.text, OBJC_ASSOCIATION_ASSIGN);
</code></pre><h4 id="deepCopyWithArchiver_3A_28Class_29archiver_unarchiver_3A_28Class_29unarchiver"><a href="#deepCopyWithArchiver_3A_28Class_29archiver_unarchiver_3A_28Class_29unarchiver" class="headerlink" title="deepCopyWithArchiver:(Class)archiver unarchiver:(Class)unarchiver"></a>deepCopyWithArchiver:(Class)archiver unarchiver:(Class)unarchiver</h4><p>利用NSKeyedArchiver及NSKeyedUnArchiver来进行真正的深拷贝。<br>具体解释可以参考以下：<a href="http://blog.csdn.net/yhawaii/article/details/7627501" target="_blank" rel="external">ObjectiveC 深浅拷贝(mutableDeepCopy)学习</a></p>

            <div class="clearfix"></div>
            <hr class="nogutter">
        </div>
        <nav class="pagination" role="pagination">
    
    <a class="pull-left" href="/2016/01/04/MADAO-s-WorkNote/" style="float: left;">
        ← MADAO's WorkNote（2015.01）
    </a>
    
    
    <a class="pull-right" href="/2015/12/29/MagicalRecord/">
        MagicalRecord →
    </a>
    
</nav>

        <div class="duoshuo">
<div class="ds-thread" data-thread-key="2015/12/30/YYKit-Learning/" data-title="YYKit Learning(一)" data-url="http://yoursite.com/2015/12/30/YYKit-Learning/"></div>
<script type="text/javascript">
var duoshuoQuery = {short_name:"duoshuo_name"};
(function() {
	var ds = document.createElement('script');
	ds.type = 'text/javascript';ds.async = true;
	ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
	ds.charset = 'UTF-8';
	(document.getElementsByTagName('head')[0] 
	 || document.getElementsByTagName('body')[0]).appendChild(ds);
})();
</script>
</div>
    </div>
</section>


      
<!-- ============================ Footer =========================== -->

<footer>
    <div class="container">
            <div class="copy">
                <p>
                    &copy; 2014<script>new Date().getFullYear()>2010&&document.write("-"+new Date().getFullYear());</script>, Content By MADAO. All Rights Reserved.
                </p>
                <p>Theme By <a href="//go.kieran.top" style="color: #767D84">Kieran</a></p>
            </div>
            <div class="social">
                <ul>
                    
                    <li><a href="https://github.com/" title="Github" target="_blank"><i class="icon-github"></i></a>&nbsp;</li>
                    
                    
                    <li><a href="https://twitter.com/" title="Twitter" target="_blank"><i class="icon-twitter"></i></a>&nbsp;</li>
                    
                    
                    <li><a href="https://www.facebook.com/" title="Facebook" target="_blank"><i class="icon-facebook"></i></a>&nbsp;</li>
                    
                    
                    <li><a href="https://google.com/" title="Google-Plus" target="_blank"><i class="icon-google-plus"></i></a>&nbsp;</li>
                    
                    
                    <li><a href="http://weibo.com/" title="Sina-Weibo" target="_blank"><i class="icon-sina-weibo"></i></a>&nbsp;</li>
                    
                </ul>
            </div>
            <div class="clearfix"> </div>
        </div>
</footer>

<!-- ============================ END Footer =========================== -->
      <!-- Load our scripts -->
        
<!-- Resizable 'on-demand' full-height hero -->
<script type="text/javascript">
    
    var resizeHero = function () {
        var hero = $(".cover,.heightblock"),
            window1 = $(window);
        hero.css({
            "height": window1.height()
        });
    };
    
    resizeHero();
    
    $(window).resize(function () {
        resizeHero();
    });
</script>
<script src="/js/plugins.min.js"></script><!-- Bootstrap core and concatenated plugins always load here -->
<script src="/js/jquery.flexslider-min.js"></script><!-- Flexslider plugin -->
<script src="/js/scripts.js"></script><!-- Theme scripts -->

<!-- Initiate flexslider plugin -->
<script type="text/javascript">
    $(document).ready(function($) {
      $('.flexslider').flexslider({
        animation: "fade",
        prevText: "",
        nextText: "",
        directionNav: true
      });
    });
</script>

</body>
</html>
